<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>THM - Retro - bynafrez08.io</title>
<meta name="description" content="Retro is a windows machine with wordpress site hosted on the port 80, which contain some credentials that allow access on the admin panel and get a reverse shell on the target machine, and lastly we escalete privileges abusing the CVE-2019-1388.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="bynafrez08.io">
<meta property="og:title" content="THM - Retro">
<meta property="og:url" content="http://localhost:4000/thm-retro/">


  <meta property="og:description" content="Retro is a windows machine with wordpress site hosted on the port 80, which contain some credentials that allow access on the admin panel and get a reverse shell on the target machine, and lastly we escalete privileges abusing the CVE-2019-1388.">



  <meta property="og:image" content="http://localhost:4000/assets/images/img-retro/retro.jpeg">





  <meta property="article:published_time" content="2022-08-08T00:00:00-04:00">





  

  


<link rel="canonical" href="http://localhost:4000/thm-retro/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="bynafrez08.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



   <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Article</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Search</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">THM - Retro</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar1.png" alt="Nafsu Uddin | AKA bynafrez" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Nafsu Uddin | AKA bynafrez</h3>
    
    
      <p class="author__bio" itemprop="description">
        Networking / Pentesting / Offensive Security
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/bynafrez08" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="THM - Retro">
    <meta itemprop="description" content="Retro is a windows machine with wordpress site hosted on the port 80, which contain some credentials that allow access on the admin panel and get a reverse shell on the target machine, and lastly we escalete privileges abusing the CVE-2019-1388.">
    <meta itemprop="datePublished" content="August 08, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">THM - Retro
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-08-08T00:00:00-04:00">August 08, 2022 </time>&emsp;
          
          
        </p>
        <p>Retro is a windows machine with wordpress site hosted on the port 80, which contain some credentials that allow access on the admin panel and get a reverse shell on the target machine, and lastly we escalete privileges abusing the CVE-2019-1388.</p>

<p align="center">
<img src="/assets/images/img-retro/retro.jpeg" />
</p>

<p>First we will create a directory with the name of the machine, and with <strong><em>mkt</em></strong> i will create the following directories to be able to organize the files of each one of those directories.</p>

<p align="center">
<img src="/assets/images/img-retro/mkt.png" />
</p>

<p>mkt is a function that i have defined in the <strong><em>~/.zshrc</em></strong> so that I can create these directories without creating them one by one.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkt () {
        mkdir {nmap,content,exploits,scripts}
}
</code></pre></div></div>

<h2 id="scanning">Scanning</h2>

<p>This machine doesn’t response icmp packets so we move directly with the nmap scan with the following parameters:</p>

<table>
  <thead>
    <tr>
      <th>Flags</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-sCV (-sC -sV)</td>
      <td>Use nmap recon scripts to discover the version and services that are running each of those ports.</td>
    </tr>
    <tr>
      <td>-Pn</td>
      <td>No ping, this machine no response icmp packets so we must assign this flag.</td>
    </tr>
    <tr>
      <td>-p</td>
      <td>specify the ports that we want to scan (i know what’s ports to scan because i do previous scan to know whats ports are open).</td>
    </tr>
    <tr>
      <td>-oN</td>
      <td>Save the scan in nmap format.</td>
    </tr>
  </tbody>
</table>

<p>As we can see here there is port 80 open with IIS and on the port 3389 is running rdp, so we can access later remotely on the target machine with rdp.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Nmap 7.92 scan initiated Wed Jul 27 19:08:06 2022 as: nmap -sCV -p80,3389 -Pn -oN targeted 10.10.68.169
</span><span class="n">Nmap</span> <span class="n">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mf">10.10.68.169</span>
<span class="n">Host</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="mf">0.047</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="o">.</span>

<span class="n">PORT</span>     <span class="n">STATE</span> <span class="n">SERVICE</span>       <span class="n">VERSION</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>   <span class="nb">open</span>  <span class="n">http</span>          <span class="n">Microsoft</span> <span class="n">IIS</span> <span class="n">httpd</span> <span class="mf">10.0</span>
<span class="o">|</span> <span class="n">http</span><span class="o">-</span><span class="n">methods</span><span class="p">:</span> 
<span class="o">|</span><span class="n">_</span>  <span class="n">Potentially</span> <span class="n">risky</span> <span class="n">methods</span><span class="p">:</span> <span class="n">TRACE</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">IIS</span> <span class="n">Windows</span> <span class="n">Server</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="p">:</span> <span class="n">Microsoft</span><span class="o">-</span><span class="n">IIS</span><span class="o">/</span><span class="mf">10.0</span>
<span class="mi">3389</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">ms</span><span class="o">-</span><span class="n">wbt</span><span class="o">-</span><span class="n">server</span> <span class="n">Microsoft</span> <span class="n">Terminal</span> <span class="n">Services</span>
<span class="o">|</span> <span class="n">ssl</span><span class="o">-</span><span class="n">cert</span><span class="p">:</span> <span class="n">Subject</span><span class="p">:</span> <span class="n">commonName</span><span class="o">=</span><span class="n">RetroWeb</span>
<span class="o">|</span> <span class="n">Not</span> <span class="n">valid</span> <span class="n">before</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">26</span><span class="n">T22</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">29</span>
<span class="o">|</span><span class="n">_Not</span> <span class="n">valid</span> <span class="n">after</span><span class="p">:</span>  <span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">25</span><span class="n">T22</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">29</span>
<span class="o">|</span><span class="n">_ssl</span><span class="o">-</span><span class="n">date</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T23</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">28</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">;</span> <span class="o">+</span><span class="mi">1</span><span class="n">s</span> <span class="k">from</span> <span class="n">scanner</span> <span class="n">time</span><span class="o">.</span>
<span class="o">|</span> <span class="n">rdp</span><span class="o">-</span><span class="n">ntlm</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> 
<span class="o">|</span>   <span class="n">Target_Name</span><span class="p">:</span> <span class="n">RETROWEB</span>
<span class="o">|</span>   <span class="n">NetBIOS_Domain_Name</span><span class="p">:</span> <span class="n">RETROWEB</span>
<span class="o">|</span>   <span class="n">NetBIOS_Computer_Name</span><span class="p">:</span> <span class="n">RETROWEB</span>
<span class="o">|</span>   <span class="n">DNS_Domain_Name</span><span class="p">:</span> <span class="n">RetroWeb</span>
<span class="o">|</span>   <span class="n">DNS_Computer_Name</span><span class="p">:</span> <span class="n">RetroWeb</span>
<span class="o">|</span>   <span class="n">Product_Version</span><span class="p">:</span> <span class="mf">10.0.14393</span>
<span class="o">|</span><span class="n">_</span>  <span class="n">System_Time</span><span class="p">:</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T23</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">27</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Service</span> <span class="n">Info</span><span class="p">:</span> <span class="n">OS</span><span class="p">:</span> <span class="n">Windows</span><span class="p">;</span> <span class="n">CPE</span><span class="p">:</span> <span class="n">cpe</span><span class="p">:</span><span class="o">/</span><span class="n">o</span><span class="p">:</span><span class="n">microsoft</span><span class="p">:</span><span class="n">windows</span>

<span class="n">Service</span> <span class="n">detection</span> <span class="n">performed</span><span class="o">.</span> <span class="n">Please</span> <span class="n">report</span> <span class="nb">any</span> <span class="n">incorrect</span> <span class="n">results</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">submit</span><span class="o">/</span> <span class="o">.</span>
<span class="c1"># Nmap done at Wed Jul 27 19:08:27 2022 -- 1 IP address (1 host up) scanned in 21.14 seconds
</span></code></pre></div></div>

<h2 id="exploitation">Exploitation</h2>

<p>So if we access on the webpage on the port 80 we can see that is a default page of IIS.</p>

<p align="center">
<img src="/assets/images/img-retro/captura2.png" />
</p>

<p>Using gobuster if we try to fuzz the webpage we can find that there is path called <strong><em>retro</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura3.png" />
</p>

<p>If we access it, we can see that is a wordpress site with some posts.</p>

<p align="center">
<img src="/assets/images/img-retro/captura4.png" />
</p>

<p>Now if we try to fuzz the retro path we can see that it’s contain dafault wordpress directories.</p>

<p align="center">
<img src="/assets/images/img-retro/captura5.png" />
</p>

<p>Now we can see that all the posts are write by the user <strong><em>Wade</em></strong> and if we look one of this posts there is comment by that user saying the word <strong><em>parzival</em></strong>, this can be some pontential credentials that wecan try to use.</p>

<p align="center">
<img src="/assets/images/img-retro/captura6.png" />
</p>

<p>Moving on the login page let’s try using this credentials to see if it’s works, which is <strong><em>wade:parzival</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura7.png" />
</p>

<p>And as you can see we have access on the admin page of this wordpress site.</p>

<p align="center">
<img src="/assets/images/img-retro/captura8.png" />
</p>

<p>Now let’s try to access on the target system, first let’s generate a payload with msfvenom to get reverse shell with php, remember that wordpress use php on the backend.</p>

<p align="center">
<img src="/assets/images/img-retro/captura9.png" />
</p>

<p>Once genereted the paylod let’s open it and we are going to remove the comments on the first line and the last, and save the payload.</p>

<p align="center">
<img src="/assets/images/img-retro/captura10.png" />
</p>

<p>In order to get reverse shell inside of the wordpress admin page is moving on the follwing path and paste the payload that we generated before, and then click on <strong><em>update file</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura11.png" />
</p>

<p>Now we are going to listening with netcat on the port that we specify on the payload and then we are going to access on the following route and it’s going to loading.</p>

<p align="center">
<img src="/assets/images/img-retro/captura12.png" />
</p>

<p>Now if we go back on our netcat listener we can see that we receive a connection to the target machine and we have access.</p>

<p align="center">
<img src="/assets/images/img-retro/captura13.png" />
</p>

<p>So if we list the directory users we can see that there is directory for the user <strong><em>wade</em></strong> but it not allow me to access on that directory and any directories on the system, so then i realised that there is rdp service enbled on this machine.</p>

<p align="center">
<img src="/assets/images/img-retro/captura15.png" />
</p>

<p>So i try to access with rpd using <strong><em>xfreerdp</em></strong> using the credentials that we saw before, and as you can see i have access on target system and view the first flag which is <strong><em>user.txt</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura16.png" />
</p>

<h2 id="privesc">PrivESC</h2>

<p>Now open a command prompt and execute the command <strong><em>whoami /priv</em></strong> to see what privileges we can abused, and anythin interesting we can find here.</p>

<p align="center">
<img src="/assets/images/img-retro/captura17.png" />
</p>

<p>Then i realised that there is chrome installed, so if we open chrome we can see that there is a site highlighted with a particular CVE.</p>

<p align="center">
<img src="/assets/images/img-retro/captura18.png" />
</p>

<p>If we access on that website we can see that is a vulnerablity to escalate privileges abusing windows certificate dialog. So maybe this machine it’s vulnerable to this particular CVE and the user maybe not mitigated.</p>

<p align="center">
<img src="/assets/images/img-retro/captura19.png" />
</p>

<p>Now if we search for this CVE we can see that there is a <a href="https://github.com/jas502n/CVE-2019-1388">Poc</a> with an exploit.</p>

<p align="center">
<img src="/assets/images/img-retro/captura20.png" />
</p>

<p>So on that repo it’s show us how to exploit this vulnerability with the following executable, so first let’s download that .exe binary and setup a http server to transfer on the victim machine.</p>

<p align="center">
<img src="/assets/images/img-retro/captura21.png" />
</p>

<p>On the target machine we are going to use <strong><em>Invoke-Webrequest</em></strong> command to download that binary.</p>

<p align="center">
<img src="/assets/images/img-retro/captura22.png" />
</p>

<p>As it indicates on the README.md file on the repo we need to run this executable with admin privileges.</p>

<p align="center">
<img src="/assets/images/img-retro/captura23.png" />
</p>

<p>It’s going to popup to ask for a admin password, here we going to click on <strong><em>show more details</em></strong> and then click on <strong><em>show information about the publisher’s certificate</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura24.png" />
</p>

<p>Once we click on that it will appear a popup to chose the browser that we want to see the information, in this case we are going to chose <strong><em>internet explorer</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura25.png" />
</p>

<p>Once the internet explorer it’s open we need go on <strong><em>settings</em></strong> the <strong><em>file</em></strong> and click on <strong><em>save as</em></strong>.</p>

<p align="center">
<img src="/assets/images/img-retro/captura26.png" />
</p>

<p>Now here if we execute <strong><em>cmd.exe</em></strong> on the following path we can see that we are as an <strong><em>nt authority\system</em></strong>, means that we are as an admins.</p>

<p align="center">
<img src="/assets/images/img-retro/captura27.png" />
</p>

<p>And with that we can access on the admin user folder and view the root flag.</p>

<p align="center">
<img src="/assets/images/img-retro/captura28.png" />
</p>

<h2 id="conclusions">Conclusions</h2>

<p>This is one of those machine that i recommend if you are starting doing ctf’s because it’s esay and it’s show you the methodology that you need follow in order to compromise a system.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#cve" class="page__taxonomy-item" rel="tag">CVE</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#tryhackme" class="page__taxonomy-item" rel="tag">Tryhackme</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#windows" class="page__taxonomy-item" rel="tag">Windows</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#wordpress" class="page__taxonomy-item" rel="tag">Wordpress</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#ctf" class="page__taxonomy-item" rel="tag">CTF</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#web" class="page__taxonomy-item" rel="tag">Web</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2022-08-08T00:00:00-04:00">August 08, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/thm-alfred/" class="pagination--pager" title="THM - Alfred
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 bynafrez08.io</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
